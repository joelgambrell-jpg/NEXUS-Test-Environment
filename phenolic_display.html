<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phenolic Display</title>

  <style>
    body{
      margin:0;
      padding:0;
      font-family:Arial, sans-serif;
      color:#fff;
      background:#b60000;
      background-image:url("transformer.jpg");
      background-repeat:no-repeat;
      background-position:center center;
      background-size:cover;
      background-attachment:fixed;
    }
    .container{
      max-width:980px;
      margin:40px auto;
      background:rgba(255,255,255,0.20);
      padding:24px;
      border-radius:18px;
      backdrop-filter:blur(6px);
    }
    .nx-header-wrap{
      background: rgba(0,0,0,0.35);
      border-bottom: 1px solid rgba(255,255,255,0.18);
      backdrop-filter: blur(8px);
    }
    .nx-header{
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 18px;
      display: flex;
      align-items: center;
    }
    .nx-header img{height:54px;width:auto;max-width:100%;object-fit:contain;}
    .nx-footer{
      margin-top: 40px;
      padding: 18px 12px;
      text-align: center;
      font-size: 12px;
      font-weight: 700;
      color: rgba(255,255,255,0.85);
      background: rgba(0,0,0,0.35);
      border-top: 1px solid rgba(255,255,255,0.18);
    }
    .nx-back-btn{
      position:fixed;
      top:64px;
      left:14px;
      z-index:9999;
      text-decoration:none;
      font-weight:900;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.18);
      color:#fff;
    }
    .title{
      margin:0 0 10px 0;
      font-size:28px;
      font-weight:900;
      text-align:center;
    }
    .pill{
      display:inline-block;
      padding:7px 10px;
      border-radius:999px;
      background: rgba(0,0,0,0.35);
      border:1px solid rgba(255,255,255,0.18);
      font-weight:900;
      font-size:12px;
      opacity:.95;
    }
    .topRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .panel{
      background: rgba(10,15,36,0.55);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 14px;
    }
    .row{
      display:grid;
      grid-template-columns: 220px 1fr;
      gap:8px 12px;
      padding:8px 0;
      border-bottom:1px dashed rgba(255,255,255,0.16);
    }
    .row:last-child{border-bottom:none;}
    .k{font-weight:900;opacity:.95;}
    .v{font-weight:800;opacity:.95;white-space:pre-wrap;}
    .btnRow{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .btn{
      appearance:none;
      border:none;
      border-radius:999px;
      padding:14px 18px;
      font-size:14px;
      font-weight:900;
      cursor:pointer;
      background:#0a0f24;
      border:2px solid #00c2ff;
      color:#3ecbff;
      text-decoration:none;
    }
    .btnPrimary{
      background:#00ff66;
      border-color:#00ff66;
      color:#002b14;
    }
  </style>

  <link rel="stylesheet" href="assets/css/nexus-core.css">
</head>
<body>

  <div id="nxSessionBanner" class="nx-session-banner">
    <div class="nx-left">
      <span class="nx-pill">Equipment: <span data-nx-eq>(none)</span></span>
      <span class="nx-pill">Role: <span data-nx-role>viewer</span></span>
      <span class="nx-pill" data-nx-status>Ready</span>
    </div>
    <div class="nx-right">
      <label style="font-weight:800;font-size:12px;opacity:.95;">Set Role
        <select id="nxRoleSelect" onchange="NEXUS.setRole(this.value)">
          <option value="viewer">viewer</option>
          <option value="tech">tech</option>
          <option value="foreman">foreman</option>
          <option value="superintendent">superintendent</option>
          <option value="admin">admin</option>
        </select>
      </label>
    </div>
  </div>

  <script>
  (function(){
    try{
      var sel=document.getElementById("nxRoleSelect");
      if(sel && window.NEXUS && typeof window.NEXUS.getRole==="function"){
        sel.value = window.NEXUS.getRole();
      }
    }catch(e){}
  })();
  </script>

  <a class="nx-back-btn" href="#" onclick="return NEXUS_back();">← Back</a>

  <div class="nx-header-wrap">
    <div class="nx-header"><img src="nexus.png" alt="NEXUS" /></div>
  </div>

  <div class="container">
    <div class="topRow">
      <div class="pill" id="eqPill">Equipment: (none)</div>
      <div class="pill" id="statusPill">Loading…</div>
    </div>

    <h1 class="title">Phenolic Display</h1>

    <div class="panel" id="panel">
      <div id="rows"></div>
    </div>

    <div class="btnRow">
      <a class="btn" id="editBtn" href="phenolic_setup.html">Edit in Setup</a>
      <button class="btn btnPrimary" id="refreshBtn" type="button">Refresh</button>
    </div>
  </div>

  <footer class="nx-footer">
    © 2026 NEXUS Data Science — Built for ACE Electric — All Rights Reserved
  </footer>

  <script src="assets/js/nexus-core.js"></script>
  <script src="assets/js/nexus-firebase-bridge.js"></script>

  <script>
  (function(){
    const qs = new URLSearchParams(location.search);
    const eq = (qs.get("eq") || "").trim();
    const eqPill = document.getElementById("eqPill");
    const statusPill = document.getElementById("statusPill");
    const rows = document.getElementById("rows");
    const editBtn = document.getElementById("editBtn");

    if (eqPill) eqPill.textContent = eq ? `Equipment: ${eq}` : "Equipment: (none)";
    if (editBtn && eq) editBtn.href = `phenolic_setup.html?eq=${encodeURIComponent(eq)}`;

    function safeJsonParse(raw){
      try{ return JSON.parse(raw); }catch(e){ return null; }
    }

    function readPhenolic(){
      if(!eq) return null;

      const raw = localStorage.getItem(`nexus_phenolic_${eq}`);
      const obj = safeJsonParse(raw || "");
      if(obj && typeof obj === "object") return obj;

      const raw2 = localStorage.getItem(`nexus_equipment_${eq}`);
      const rec = safeJsonParse(raw2 || "");
      if(rec && rec.phenolic && typeof rec.phenolic === "object") return rec.phenolic;

      return null;
    }

    function esc(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;");
    }

    function render(p){
      rows.innerHTML = "";
      if(!p){
        rows.innerHTML = `<div style="font-weight:900;opacity:.95;">No phenolic has been saved in Setup yet.</div>`;
        if(statusPill) statusPill.textContent = "Not set";
        return;
      }

      const fields = [
        ["Job Name", p.jobName],
        ["Foreman", p.foreman],
        ["Crew", p.crew],
        ["Material", p.material],
        ["Batch / Lot", p.batchLot],
        ["Mix Ratio", p.mixRatio],
        ["Ambient Temp", p.ambientTemp],
        ["Surface Temp", p.surfaceTemp],
        ["Humidity", p.humidity],
        ["Pot Life", p.potLife],
        ["Cure Time", p.cureTime],
        ["Notes", p.notes],
        ["Updated", p.updatedAt]
      ];

      rows.innerHTML = fields
        .filter(([k,v]) => String(v ?? "").trim().length > 0)
        .map(([k,v]) => `
          <div class="row">
            <div class="k">${esc(k)}</div>
            <div class="v">${esc(v)}</div>
          </div>
        `).join("");

      if(statusPill) statusPill.textContent = p.updatedAt ? "Loaded ✓" : "Loaded";
    }

    function refresh(){ render(readPhenolic()); }

    document.getElementById("refreshBtn").addEventListener("click", refresh);
    refresh();

    window.NEXUS_back = function(){
      try{
        if (document.referrer && document.referrer.indexOf(location.host) !== -1){
          history.back();
          return false;
        }
      }catch(e){}
      location.href = eq ? `equipment.html?eq=${encodeURIComponent(eq)}` : "equipment.html";
      return false;
    };
  })();
  </script>
</body>
</html>
