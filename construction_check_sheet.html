<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Construction Check Sheet</title>

<link rel="stylesheet" href="assets/css/nexus-core.css"/>

<style>

/* ================= BACKGROUND ================= */

body{
  margin:0;
  font-family:system-ui, -apple-system, Segoe UI, Roboto;
  background:url("assets/img/construction-bg.jpg") center/cover no-repeat fixed;
}

body::before{
  content:"";
  position:fixed;
  inset:0;
  backdrop-filter: blur(9px) brightness(.55);
  z-index:-1;
}


/* ================= TOP BAR ================= */

.topbar{
  display:flex;
  align-items:center;
  gap:12px;
  padding:14px 28px;
  background:rgba(0,0,0,.65);
  backdrop-filter: blur(6px);
  color:#fff;
}

.topbar button{
  padding:7px 12px;
  border-radius:12px;
  border:none;
  cursor:pointer;
  font-weight:600;
}

.status{
  margin-left:auto;
  font-size:13px;
  opacity:.9;
}

.back-btn{
  padding:7px 14px;
  border-radius:14px;
  background:rgba(255,255,255,.15);
  color:#fff;
  text-decoration:none;
  font-weight:700;
}

.back-btn:hover{
  background:rgba(255,255,255,.25);
}


/* ================= MAIN CARD ================= */

.glass-card{
  max-width:1350px;
  margin:28px auto;
  padding:26px;
  border-radius:20px;
  background:rgba(255,255,255,.93);
  backdrop-filter: blur(10px);
  box-shadow:0 25px 60px rgba(0,0,0,.35);
}


/* ================= TABLE ================= */

.grid{
  display:grid;
  grid-template-columns: 70px 2fr 1fr 140px 150px 80px;
  gap:8px;
  align-items:center;
}

.header{
  font-weight:800;
  position:sticky;
  top:0;
  background:#f6f6f6;
  border-bottom:1px solid #ddd;
  padding:8px 0;
  z-index:2;
}

.cell input{
  width:100%;
  padding:6px 8px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:13px;
}

.section-title{
  font-weight:800;
  font-size:20px;
  margin-bottom:14px;
}

.signoff{
  background:#8bc34a;
  font-weight:700;
}

.locked input{
  background:#eee;
  pointer-events:none;
}

button.small{
  padding:4px 7px;
  font-size:12px;
  cursor:pointer;
}

@media(max-width:900px){
  .grid{ grid-template-columns:1fr; }
}

</style>
</head>



<body>

<!-- ================= TOP BAR ================= -->

<div class="topbar">

  <a id="backBtn" class="back-btn">← Back to Equipment</a>

  <button id="lockBtn">Lock</button>
  <button id="addBtn">+ Row</button>
  <button id="exportBtn">Export JSON</button>

  <span id="status" class="status">Saved</span>
</div>



<!-- ================= MAIN CARD ================= -->

<div class="glass-card">

<h1>Construction Check Sheet</h1>
<h3 id="equipmentLabel"></h3>

<div class="section-title">Inspection Items</div>

<div id="sheet"></div>

</div>



<script>

/* ================= ROUTING ================= */

const params = new URLSearchParams(window.location.search);
const eq = params.get("eq") || "";

document.getElementById("equipmentLabel").textContent = eq ? "Equipment: "+eq : "";

document.getElementById("backBtn").href =
  "equipment.html" + (eq ? "?eq="+encodeURIComponent(eq) : "");


/* ================= DATA ================= */

const KEY = "construction:"+eq;
const sheet = document.getElementById("sheet");
const status = document.getElementById("status");

const defaultRows = [

  {text:"Building Number"},
  {text:"Phase"},
  {text:"Foreman"},
  {text:"Equip ID"},
  {text:"RIF Completed"},
  {text:"Labels installed by QCX"},
  {text:"Phenolic"},
  {text:"Arc Flash"},

  {text:"QCX → Construction Handoff", sign:true},

  {text:'6" clearance from walls and panels'},
  {text:"Remove front cover bolts, bag & tag"},
  {text:"Shipping assembly (if required)"},
  {text:"Apply proper cover protection"},
  {text:'Anchored using 1/2" wedge anchors'},
  {text:"Housing mounted square and level"},
  {text:"XFMR NETA tested (validated by QCX)"},

  {text:"Construction → QCX Final Handoff", sign:true},

  {text:"Construction Foreman Name"},
  {text:"QCX Foreman Name"},
  {text:"Date"}
];

let rows=[];


/* ================= RENDER ================= */

function render(){

  sheet.innerHTML="";

  const header=document.createElement("div");
  header.className="grid header";
  header.innerHTML=`
    <div>Step</div>
    <div>Procedure</div>
    <div>Entry</div>
    <div>Sign Off</div>
    <div>Date</div>
    <div></div>
  `;
  sheet.appendChild(header);

  rows.forEach((r,i)=>{

    const row=document.createElement("div");
    row.className="grid cell"+(r.sign?" signoff":"");

    row.innerHTML=`
      <div>${i+1}</div>
      <input value="${r.text||""}">
      <input value="${r.entry||""}">
      <input value="${r.signer||""}">
      <input type="date" value="${r.date||""}">
      <div>
        <button class="small add">+</button>
        <button class="small del">−</button>
      </div>
    `;

    const inputs=row.querySelectorAll("input");

    inputs.forEach(()=>{});

    inputs.forEach(inp=>{
      inp.oninput=()=>{
        r.text=inputs[0].value;
        r.entry=inputs[1].value;
        r.signer=inputs[2].value;
        r.date=inputs[3].value;
        save();
      };
    });

    row.querySelector(".add").onclick=()=>{
      rows.splice(i+1,0,{text:"New Item"});
      render(); save();
    };

    row.querySelector(".del").onclick=()=>{
      rows.splice(i,1);
      render(); save();
    };

    sheet.appendChild(row);
  });
}


/* ================= SAVE / LOAD ================= */

function save(){
  localStorage.setItem(KEY,JSON.stringify(rows));
  status.textContent="Saved";
}

function load(){
  rows = JSON.parse(localStorage.getItem(KEY)||"null") || defaultRows;
}


/* ================= BUTTONS ================= */

document.getElementById("lockBtn").onclick=()=>{
  document.querySelector(".glass-card").classList.toggle("locked");
};

document.getElementById("addBtn").onclick=()=>{
  rows.push({text:"New Item"});
  render(); save();
};

document.getElementById("exportBtn").onclick=()=>{
  const blob=new Blob([JSON.stringify(rows,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="construction-sheet.json";
  a.click();
};


/* ================= INIT ================= */

load();
render();

</script>

</body>
</html>
